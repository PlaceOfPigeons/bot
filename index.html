<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: white; /* Белый фон */
            color: black; /* Чёрный текст */
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
        }
        button {
            background-color: black; /* Чёрная кнопка */
            color: white; /* Белый текст на кнопке */
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: grey; /* Серый фон при наведении */
        }
    </style>
</head>
<body>
    <h1>Telegram Web App</h1>
    <p id="userInfo">Загрузка данных пользователя...</p> <!-- Место для отображения данных пользователя -->
    <p>Эта страница интегрирована с Telegram Web App API.</p>
    <button id="sendPoints">Send Points</button>

    <script>
        // Получаем данные Telegram Web App
        const tg = window.Telegram.WebApp;

        // Инициализация Telegram Web App
        tg.ready();

        // Функция для получения данных пользователя и отображения их на странице
        function fetchUserData() {
            // Получаем информацию о пользователе через Telegram Web App API
            const userName = tg.initDataUnsafe?.user?.username || "Неизвестно";
            const userId = tg.initDataUnsafe?.user?.id || "Неизвестно";
            const userPoints = 0;  // Начальные очки (вы получите их с сервера позже)

            // Обновляем информацию на странице
            document.getElementById('userInfo').innerHTML = `
                <strong>Имя пользователя:</strong> ${userName}<br>
                <strong>ID пользователя:</strong> ${userId}<br>
                <strong>Очки:</strong> ${userPoints}<br>
            `;
        }

        // Вызов функции для получения данных
        fetchUserData();

        // Обработчик нажатия на кнопку
        document.getElementById('sendPoints').addEventListener('click', () => {
            const initData = tg.initData; // Получаем initData
            const points = 100; // Очки для отправки

            // Отправляем данные на сервер для сохранения очков
            fetch("https://frozen-dawn-48680-9cdb4d5a9403.herokuapp.com/submit_points", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    initData: initData,
                    points: points,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(`Ошибка: ${data.error}`);
                    } else {
                        alert("Очки успешно отправлены!");
                    }
                })
                .catch(error => {
                    console.error("Ошибка:", error);
                });
        });
    </script>
</body>
</html>
